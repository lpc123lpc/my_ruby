<p id="notice"><%= notice %></p>

<% if user_signed_in? %>
  <h1>图书信息</h1>

  <%= form_with(url: '/books', method: 'get', local: true) do %>
    <%= text_field_tag(:search) %>
    <%= submit_tag("Search") %>
  <% end %>

  <%= link_to "高级检索", new_search_path %>

<table>
  <thead>
    <tr>
      <th>图书编号</th>
      <th>书名</th>
      <th>作者</th>
      <th>出版社</th>
      <th>价格</th>
      <th>入库日期</th>
      <th>图书类别</th>
      <th>图书状态</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>

    <% @books.each do |book| %>
      <tr>
        <td><%= book.id %></td>
        <td><%= book.title %></td>
        <td><%= book.author %></td>
        <td><%= book.press %></td>
        <td><%= book.price %></td>
        <td><%= book.intime %></td>
        <td><%= book.category %></td>
        <td><%= book.state %></td>
        <% if current_user.admin? %>
          <td><%= link_to '编辑图书信息', edit_book_path(book) %></td>
          <td><%= link_to '删除图书', book, method: :delete, data: { confirm: 'Are you sure?' } %></td>
        <% end %>
        <td><%= link_to '显示详细信息', book %></td>
        <% if current_user.student? %>
          <% if book.state == "已借阅" || book.state == "已损坏"%>
            <td><%= "暂时无法借阅" %></td>
          <% else %>
            <td><%= link_to '借阅本书', new_borrowtable_path(:book_id => book.id, :book_title => book.title) %></td>
          <% end %>
        <% end %>
      </tr>
    <% end %>

  </tbody>
</table>

<br>
<% if current_user.admin? %>
  <%= link_to '新增图书', new_book_path %>
<% end %>
<% end %>